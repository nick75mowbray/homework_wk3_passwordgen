<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Generator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="style.css"/>
    
</head>
<body>
    <div id="container" class="container">
        <!-- <div class="container-fluid"> -->
            <h1>Password Generator</h1>
            <div class="container-fluid text-center" id="password-is" >
                <p>Your new password is:</p>
                <p id="password-output"></p>
            </div>
    <form id="myform">
        <div class="form-group">
            <label for="length">please enter password length:</label>
            <input type="number" class="form-control" name="length" value="">
            <small id="invalidLength" class="form-text text-muted" style="display: none;">
                please enter a number between 8 and 128
              </small>
        </div>
        <div class="form-check form-group">
            <input class="form-check-input" type="checkbox" id="lowercase" value="">
            <label class="form-check-label" for="lowercase">include lowercase letters</label>
        </div>
            <div class="form-check form-group">
            <input class="form-check-input" type="checkbox" id="uppercase" value="">
            <label class="form-check-label" for="uppercase">include uppercase letters</label>
        </div>
            <div class="form-check form-group">
            <input class="form-check-input" type="checkbox" id="numbers" value="">
            <label class="form-check-label" for="numbers">include numbers</label>
        </div>
            <div class="form-check form-group">
            <input class="form-check-input" type="checkbox" id="special" value="">
            <label class="form-check-label" for="special">include special characters</label>
        </div>
        <small id="invalidSelection" class="form-text text-muted" style="display: none;">
            please select at least 1 character type
          </small>
          
          
        </form>
        <button class="btn btn-danger" onclick="genPassword()">Generate Password</button>
        <br>
        <a href="prompt.html">CLICK HERE for a version that uses prompts and alerts</a>
    </div>
    


   <script>
    var myform = document.forms.myform;
    var invalidLengthText = document.getElementById("invalidLength");
    var invalidSelection = document.getElementById("invalidSelection");
    var lowercaseCheckbox = myform.lowercase;
    var uppercaseCheckbox = myform.uppercase;
    var numbersCheckbox = myform.numbers;
    var specialCheckbox = myform.special;

    //declare variables
    var newPassword = "";
    var passLength = myform.length.value;
    console.log(passLength);
    var passLower = myform.lowercase.checked;
    var passUpper = myform.uppercase.checked;
    var passNum = myform.numbers.checked;
    var passSpec = myform.special.checked;
    var typeCount = 0;
    

//functions to get random character of selected type using ascii character numbers
function genRandNum() {
    var min = Math.ceil(48);
    var max = Math.floor(57);
    return Math.floor(Math.random() * (max - min + 1) + min); 
};
function genRandSpecial() {
    var min = Math.ceil(33);
    var max = Math.floor(47);
    return Math.floor(Math.random() * (max - min + 1) + min); 
};
function genRandUpper() {
    var min = Math.ceil(65);
    var max = Math.floor(90);
    return Math.floor(Math.random() * (max - min + 1) + min); 
};
function genRandLower() {
    var min = Math.ceil(97);
    var max = Math.floor(122);
    return Math.floor(Math.random() * (max - min + 1) + min); 
};
//function to convert ascii number to ascii character
function convertToString(number){
    result = String.fromCharCode(number);
    return result;
};

// function to randomly select character type to add to password and randomly select a character of that type
function randomCharGenerator(passwordLength){
    for (var i = 0; i < passwordLength; i++){
            var randomArrayIndex = 0;
            randomArrayIndex = Math.floor(Math.random() * 4);
            if (randomArrayIndex === 0 && passNum === true){
                newPassword = newPassword + convertToString(genRandNum());
                console.log(`add digit to password ${newPassword}`);
            } else if (randomArrayIndex === 1 && passLower === true){
                newPassword = newPassword + convertToString(genRandLower());
                console.log(`add digit to password ${newPassword}`);
            } else if (randomArrayIndex === 2 && passUpper === true){
                newPassword = newPassword + convertToString(genRandUpper());
                console.log(`add digit to password ${newPassword}`);
            } else if (randomArrayIndex === 3 && passSpec === true){
                newPassword = newPassword + convertToString(genRandSpecial());
                console.log(`add digit to password ${newPassword}`);
                //if randomArrayIndex randomly selects a type that isnt selected run loop again
            } else if ((randomArrayIndex === 0 && passNum !== true) || (randomArrayIndex === 1 && passLower !== true) || (randomArrayIndex === 2 && passUpper !== true) || (randomArrayIndex === 3 && passSpec !== true)){
                    i--;
            } 
        }
        return newPassword;
}
//generate password, runs when button clicked
function genPassword(){
    lowercaseCheckbox = myform.lowercase;
    uppercaseCheckbox = myform.uppercase;
    numbersCheckbox = myform.numbers;
    specialCheckbox = myform.special;

    console.log(`lowercaseCheckbox = ${lowercaseCheckbox}`);
    console.log(`numbersCheckbox = ${numbersCheckbox}`);

    //declare variables
    newPassword = "";
    passLength = myform.length.value;
    console.log(`passLength is ${passLength}`);
    passLower = myform.lowercase.checked;
    passUpper = myform.uppercase.checked;
    passNum = myform.numbers.checked;
    passSpec = myform.special.checked;


    console.log(`passLower = ${passLower}`);
    console.log(`passNum = ${passNum}`);
    console.log(`passUpper = ${passUpper}`);
    console.log(`passSpec = ${passSpec}`);

        //variables to check if password contains character type
        var containsNumber = false;
        var containsSpecial = false;
        var containsLower = false;
        var containsUpper = false;
        // variables to confirm the users input is valid
        var lengthInvalid = false;
        var charsInvalid = false;

        //user enters password length
        //will loop until password length is valid
       
            // this will run if user enters a invalid length
            if (passLength < 8 || passLength > 128){
                lengthInvalid = true;
                myform.length.style.boxShadow = "0 0 0 0.2rem rgba(252, 60, 46, 0.774)";
                invalidLengthText.style.display="block";
                console.log("length invalid");
            } else {
                myform.length.style.boxShadow = "none";
                invalidLengthText.style.display="none";
            };

        //user selects character types
        //runs until one character type is selected
            //if user doesn't select any character types
            if (passLower===false && passUpper===false && passNum===false && passSpec===false){
                charsInvalid = true;
                invalidSelection.style.display = "block";
                lowercaseCheckbox.style.boxShadow = "0 0 0 0.2rem rgba(252, 60, 46, 0.774)";
                uppercaseCheckbox.style.boxShadow = "0 0 0 0.2rem rgba(252, 60, 46, 0.774)";
                numbersCheckbox.style.boxShadow = "0 0 0 0.2rem rgba(252, 60, 46, 0.774)";
                specialCheckbox.style.boxShadow = "0 0 0 0.2rem rgba(252, 60, 46, 0.774)";
                console.log("type selection invalid");
            } else {                
                invalidSelection.style.display = "none";
                lowercaseCheckbox.style.boxShadow = "none";
                uppercaseCheckbox.style.boxShadow = "none";
                numbersCheckbox.style.boxShadow = "none";
                specialCheckbox.style.boxShadow = "none";

            };
            
        //randomly select type and randomly select character within that type
        // loop stops before the desired password length to make sure the generated password contains at 
        // least one of each selected character type
        if (charsInvalid===false && lengthInvalid===false){
            newPassword = randomCharGenerator(passLength);
            console.log(`password after first run = ${newPassword}`);
        } else {
            return;
        }
        // check all selected types are included in password
        for (var i = 0; i < newPassword.length; i ++){
            //convert password string to number
            var number = newPassword.charCodeAt(i);
            if (number <= 57 && number >= 48){
                containsNumber = true;
            } else if (number >= 33 && number <=47){
                containsSpecial = true;
            } else if (number >= 65 && number <=90){
                containsUpper = true;
            } else if (number >= 97 && number <=122){
                containsLower = true;
            } 
        };
        console.log(`check for any missing types: 
        containsNumber = ${containsNumber}
        containsSpecail = ${containsSpecial}
        containsUpper = ${containsUpper}
        containsLower = ${containsLower}`);

        if (    (containsLower===false && passLower===true) 
            || (containsUpper===false && passUpper===true)
            || (containsNumber===false && passNum===true)
            || (containsSpecial===false && passSpec===true)){
                console.log("ran generator again");
            genPassword();
        } else {
            document.getElementById("password-is").style.display= "block";
            document.getElementById('password-output').innerHTML= newPassword;
        }
}
    
   </script>
</body>
</html>